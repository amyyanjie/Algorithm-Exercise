---
title: 112.基本计算器 II
english_title: basic-calculator-ii
date: 2021-03-13 16:03:11
tags: LeetCode
categories: /DataStructure
---

## 题目

给你一个字符串表达式 `s` ，请你实现一个基本计算器来计算并返回它的值。

整数除法仅保留整数部分。

**示例 1：**

```
输入：s = "3+2*2"
输出：7
```

**示例 2：**

```
输入：s = " 3/2 "
输出：1
```

**示例 3：**

```
输入：s = " 3+5 / 2 "
输出：5
```

**提示：**

- `1 <= s.length <= 3 * 105`
- `s` 由整数和算符 `('+', '-', '*', '/')` 组成，中间由一些空格隔开
- `s` 表示一个 **有效表达式**
- 表达式中的所有整数都是非负整数，且在范围 `[0, 231 - 1]` 内
- 题目数据保证答案是一个 **32-bit 整数**

## 题解：栈

注意本题中字符串只有整数和算符，没有括号。

可以用 sign 保存当前算符，初始为'+'。

维护一个栈 stack，保存可以直接累加的数值：

* 若遇到 算符`('+', '-', '*', '/')` ，更新当前 sign 值。
* 若遇到数字，先获取完整数字 num 。然后根据当前 sign ：
  * 若` '+' = sign`，直接将 num 压入栈顶。
  * 若` '-' = sign`，直接将 -num 压入栈顶。
  * 若` '*' = sign`，乘法优先级高，将栈顶元素 * num 的结果压入栈顶。
  * 若` '/' = sign`，除法优先级高，将栈顶元素 / num 的结果压入栈顶。
* 最后将 栈中所有元素累加，即为最后结果。

```java
    public int calculate(String s) {
        Deque<Integer> stack = new ArrayDeque<>();
        char sign = '+';
        for (int i = 0; i < s.length(); i++) {
            char c = s.charAt(i);
            if (' ' == c) {
            } else if (Character.isDigit(c)) {
                int j = i;
                int num = 0;
                while (j < s.length() && Character.isDigit(s.charAt(j))) {
                    num = num * 10 + s.charAt(j) - '0';
                    j += 1;
                }
                i = j - 1;
                if (sign == '+') {
                    stack.addLast(num);
                } else if (sign == '-') {
                    stack.addLast(-num);
                } else if (sign == '*') {
                    num = stack.removeLast() * num;
                    stack.addLast(num);
                } else if (sign == '/') {
                    num = stack.removeLast() / num;
                    stack.addLast(num);
                }
            } else {
                sign = c;
            }
        }
        int res = 0;
        while (!stack.isEmpty()) {
            res += stack.removeLast();
        }
        return res;
    }
```

* 时间复杂度：O(n)。
* 空间复杂度：O(n)。

[227. 基本计算器 II](https://leetcode-cn.com/problems/basic-calculator-ii/)